{
  "project": "Des Moines AI Pulse",
  "branchName": "ralph/enterprise-readiness",
  "description": "Enterprise & Production Readiness — Comprehensive hardening of the Des Moines AI Pulse platform across CI/CD, testing, security, observability, code quality, performance, accessibility, and documentation to achieve enterprise-grade production standards.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create GitHub Actions PR validation workflow",
      "description": "As a developer, I need automated PR checks so that every pull request is validated for lint, type safety, and build integrity before merge.",
      "acceptanceCriteria": [
        "Create .github/workflows/pr-checks.yml that triggers on pull_request to main",
        "Workflow runs: npm ci, npm run lint, npm run type-check, npm run build",
        "Workflow uses Node 20 and caches node_modules via actions/cache",
        "Workflow fails if any step fails, blocking merge",
        "Typecheck passes locally"
      ],
      "priority": 1,
      "passes": false,
      "notes": "The project currently only has an event-crawler.yml workflow. This is the single most critical gap for enterprise readiness — no code quality gates exist in CI."
    },
    {
      "id": "US-002",
      "title": "Set up Vitest unit testing framework",
      "description": "As a developer, I need a unit testing framework so that individual functions, hooks, and components can be tested in isolation without spinning up a full browser.",
      "acceptanceCriteria": [
        "Install vitest, @testing-library/react, @testing-library/jest-dom, jsdom as devDependencies",
        "Create vitest.config.ts with jsdom environment, path aliases matching vite.config.ts, and coverage configuration",
        "Add scripts to package.json: test:unit, test:unit:coverage, test:unit:watch",
        "Create src/__tests__/setup.ts with testing-library matchers",
        "Create one passing example test (e.g., src/lib/__tests__/utils.test.ts) that tests an exported utility function",
        "npm run test:unit passes with the example test",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Currently the project only has Playwright E2E tests. No unit testing framework exists. Vitest is the natural choice since the project already uses Vite."
    },
    {
      "id": "US-003",
      "title": "Write unit tests for core utility libraries",
      "description": "As a developer, I need tests for the core utility libraries so that foundational functions like error handling, storage, and utilities are verified to work correctly.",
      "acceptanceCriteria": [
        "Create src/lib/__tests__/errorHandler.test.ts testing handleError, withErrorHandling, createComponentErrorHandler with at least 5 test cases",
        "Create src/lib/__tests__/safeStorage.test.ts testing get, set, remove, and fallback behavior when localStorage is unavailable with at least 4 test cases",
        "Create src/lib/__tests__/utils.test.ts testing key exported utility functions with at least 5 test cases",
        "All tests pass via npm run test:unit",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": "Focus on the three most critical library files: errorHandler.ts, safeStorage.ts, and utils.ts. These are used across the entire codebase."
    },
    {
      "id": "US-004",
      "title": "Integrate unit tests and build check into CI/CD workflow",
      "description": "As a developer, I need unit tests running in CI so that regressions are caught automatically on every PR.",
      "acceptanceCriteria": [
        "Update .github/workflows/pr-checks.yml to include npm run test:unit step after lint and typecheck",
        "Test step runs with coverage reporting (--coverage flag)",
        "Add a build verification step that runs npm run build after tests",
        "Workflow remains fast (use caching, parallel jobs where possible)",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": "Depends on US-001 (workflow) and US-002 (vitest setup). This ensures tests are enforced, not just available."
    },
    {
      "id": "US-005",
      "title": "Create structured logging utility",
      "description": "As a developer, I need a structured logging utility so that log output is consistent, leveled, and automatically suppressed in production builds.",
      "acceptanceCriteria": [
        "Create src/lib/logger.ts with log levels: debug, info, warn, error",
        "Logger accepts context object: { component: string, action: string, metadata?: Record<string, unknown> }",
        "In production (import.meta.env.PROD), debug and info levels are no-ops",
        "In development, logs include timestamp, level, component, action, and message",
        "Export a default logger instance and a createLogger(component: string) factory",
        "Add unit test in src/lib/__tests__/logger.test.ts with at least 4 test cases covering level filtering and context",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": "This replaces the 188 files of raw console.log with a structured alternative. Must be created before the cleanup stories."
    },
    {
      "id": "US-006",
      "title": "Add ESLint no-console rule and fix violations in src/lib/",
      "description": "As a developer, I need a lint rule preventing raw console usage so that new code uses the structured logger and existing critical library code is migrated.",
      "acceptanceCriteria": [
        "Add 'no-console': 'warn' rule to eslint.config.js (warn, not error, to allow gradual migration)",
        "Replace all console.log/warn/error calls in src/lib/ files with the structured logger from US-005",
        "No console.* calls remain in any file under src/lib/ (excluding test files)",
        "npm run lint passes (no errors; console warnings in other directories are acceptable as warnings)",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": "Start with src/lib/ because these are the foundational utilities used everywhere. Subsequent stories will clean up hooks and components."
    },
    {
      "id": "US-007",
      "title": "Replace console.log in src/hooks/ with structured logger",
      "description": "As a developer, I need clean logging in hooks so that debugging output is structured and production-safe across all custom hooks.",
      "acceptanceCriteria": [
        "Replace all console.log/warn/error calls in src/hooks/ files with the structured logger",
        "Each logger instance uses createLogger with the hook name as component",
        "No raw console.* calls remain in src/hooks/ directory",
        "npm run lint passes for src/hooks/ (no console warnings)",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": "There are 116 custom hooks. Focus on replacing console.* with logger calls. Some hooks may have no console usage — skip those."
    },
    {
      "id": "US-008",
      "title": "Replace console.log in src/contexts/ and src/pages/ with structured logger",
      "description": "As a developer, I need clean logging in contexts and pages so that application-level debugging is structured throughout.",
      "acceptanceCriteria": [
        "Replace all console.log/warn/error calls in src/contexts/ with structured logger",
        "Replace all console.log/warn/error calls in src/pages/ with structured logger",
        "No raw console.* calls remain in either directory",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": "Contexts are critical (AuthContext handles auth state). Pages are user-facing entry points. Both should have clean logging."
    },
    {
      "id": "US-009",
      "title": "Replace console.log in src/components/ with structured logger",
      "description": "As a developer, I need clean logging in components so that the largest source of console.log usage is cleaned up.",
      "acceptanceCriteria": [
        "Replace all console.log/warn/error calls in src/components/ with structured logger",
        "No raw console.* calls remain in src/components/ directory (excluding src/components/ui/ which are third-party generated)",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": "This is the largest batch — 178 components. Many may already be clean. Focus on files that actually have console.* calls. The shadcn/ui base components in src/components/ui/ can be excluded if they have no console calls."
    },
    {
      "id": "US-010",
      "title": "Integrate Sentry error tracking",
      "description": "As an operations engineer, I need production error tracking so that runtime errors are captured, reported, and triaged without relying on user reports.",
      "acceptanceCriteria": [
        "Install @sentry/react as a dependency",
        "Create src/lib/sentry.ts that initializes Sentry with DSN from VITE_SENTRY_DSN environment variable",
        "Initialize Sentry in src/main.tsx before React renders, only when VITE_SENTRY_DSN is set",
        "Update the ErrorTrackingService in src/lib/errorHandler.ts to use Sentry.captureException and Sentry.captureMessage",
        "Wire initErrorTracking() to actually initialize the Sentry service instead of being a placeholder",
        "Add VITE_SENTRY_DSN to .env.example with a comment explaining setup",
        "Wrap the root App component with Sentry.ErrorBoundary as a fallback to the existing ErrorBoundary",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": "The codebase already has an ErrorTrackingService interface and initErrorTracking placeholder. This story fills in the actual implementation. The DSN will be configured per-environment at deploy time."
    },
    {
      "id": "US-011",
      "title": "Add security headers via Cloudflare Pages configuration",
      "description": "As a security engineer, I need proper HTTP security headers so that the application is protected against common web attacks like XSS, clickjacking, and MIME sniffing.",
      "acceptanceCriteria": [
        "Create public/_headers file with Cloudflare Pages header rules",
        "Add Content-Security-Policy header with appropriate directives for the app (allow Supabase, Stripe, Leaflet tile servers, inline styles for Tailwind)",
        "Add Strict-Transport-Security: max-age=31536000; includeSubDomains",
        "Add X-Content-Type-Options: nosniff",
        "Add X-Frame-Options: DENY",
        "Add Referrer-Policy: strict-origin-when-cross-origin",
        "Add Permissions-Policy restricting camera, microphone, geolocation to self",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": "Cloudflare Pages supports a _headers file in the output directory (public/ gets copied to dist/). CSP must be carefully crafted to not break Supabase realtime, Stripe checkout, Leaflet maps, or inline Tailwind styles."
    },
    {
      "id": "US-012",
      "title": "Audit and document unauthenticated edge functions",
      "description": "As a security engineer, I need a documented audit of all edge functions with verify_jwt=false so that the security posture is understood and intentional.",
      "acceptanceCriteria": [
        "Review all edge functions with verify_jwt = false in their config.toml",
        "For each unauthenticated function, add a comment block at the top explaining WHY authentication is disabled and what alternative security measures exist (API key, webhook secret, IP restriction, rate limiting, etc.)",
        "Create docs/SECURITY_AUDIT.md documenting all 18 unauthenticated functions with their justification and risk level (low/medium/high)",
        "Identify any functions that SHOULD have auth enabled but don't, and enable verify_jwt = true for those",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": "18 of 76 edge functions have verify_jwt=false. Many are background jobs (scrapers, crawlers) which is acceptable. But some may be misconfigured. The audit creates accountability."
    },
    {
      "id": "US-013",
      "title": "Add API key authentication middleware for data processing edge functions",
      "description": "As a security engineer, I need API key authentication on data processing endpoints so that scrapers and crawlers cannot be triggered by unauthorized parties.",
      "acceptanceCriteria": [
        "Create supabase/functions/_shared/apiKeyAuth.ts middleware that validates an X-API-Key header against a WORKER_API_KEY secret",
        "Apply API key middleware to scraper/crawler functions that are currently unauthenticated: ai-crawler, scrape-events, restaurant-opening-scraper, firecrawl-scraper, bulk-enhance-events, bulk-event-updater",
        "Functions return 401 Unauthorized when called without a valid API key",
        "Functions continue to work when called with the correct API key",
        "Update the event-crawler GitHub Action workflow to pass the API key when invoking edge functions",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": "These functions process external data and modify the database. Without API key auth, anyone who discovers the function URL can trigger bulk data operations."
    },
    {
      "id": "US-014",
      "title": "Standardize rate limiting across all public edge functions",
      "description": "As a security engineer, I need consistent rate limiting on all public-facing edge functions so that abuse and denial-of-service attacks are mitigated.",
      "acceptanceCriteria": [
        "Audit all edge functions for rate limiting usage",
        "Ensure every public-facing function (those callable from the frontend) imports and uses the rate limiter from _shared/rateLimit.ts",
        "Standardize rate limits: 100 req/15min for read operations, 30 req/15min for write operations, 10 req/15min for checkout/payment operations",
        "Document rate limit tiers in a comment at the top of _shared/rateLimit.ts",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": "The rate limiter exists in _shared/rateLimit.ts but not all functions use it. Payment functions already have stricter limits (10 req/15min). This story ensures consistency."
    },
    {
      "id": "US-015",
      "title": "Audit and migrate direct localStorage usage to safeStorage",
      "description": "As a security-conscious developer, I need all localStorage access to go through the safe wrapper so that the app handles private browsing mode gracefully and sensitive data is not stored insecurely.",
      "acceptanceCriteria": [
        "Search all source files for direct localStorage.getItem, localStorage.setItem, localStorage.removeItem calls",
        "Replace each with the equivalent safeStorage (storage.get, storage.set, storage.remove) from @/lib/safeStorage",
        "Verify no sensitive data (tokens, passwords, PII) is stored in localStorage — if found, remove it or move to session-only storage",
        "No direct localStorage.* calls remain in src/ (excluding node_modules and test files)",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": "14 files currently use localStorage directly. The safeStorage wrapper handles try-catch for private browsing mode and provides typed access."
    },
    {
      "id": "US-016",
      "title": "Begin TypeScript strict mode migration for src/lib/",
      "description": "As a developer, I need TypeScript strict mode on core libraries so that null safety and type correctness are enforced where it matters most.",
      "acceptanceCriteria": [
        "Enable strict mode checks for all files in src/lib/ by adding them to tsconfig.strict.json include paths",
        "Fix all strict mode TypeScript errors in src/lib/ files (strictNullChecks, noImplicitAny, etc.)",
        "Replace any usage of 'any' type in src/lib/ with proper types (unknown, specific types, or generics)",
        "npm run type-check:strict passes for src/lib/ files",
        "npm run type-check (relaxed) still passes for the full project",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": false,
      "notes": "The project has 682 instances of 'any' type. Starting with src/lib/ is strategic because these utilities are imported everywhere — fixing them improves downstream type safety."
    },
    {
      "id": "US-017",
      "title": "TypeScript strict mode migration for critical hooks",
      "description": "As a developer, I need TypeScript strict mode on critical hooks so that the most-used data fetching and auth hooks have full type safety.",
      "acceptanceCriteria": [
        "Enable strict mode for these hooks: useAuth (in contexts/AuthContext.tsx), use-events.ts, use-restaurants.ts, use-attractions.ts, useSubscription.ts, useTripPlanner.ts",
        "Fix all strict mode TypeScript errors in these files",
        "Replace 'any' types with proper types in these files",
        "npm run type-check:strict passes for these files",
        "npm run type-check (relaxed) still passes for the full project",
        "Typecheck passes"
      ],
      "priority": 17,
      "passes": false,
      "notes": "These are the most commonly referenced hooks in CLAUDE.md. Strict typing here cascades type safety to all consumers."
    },
    {
      "id": "US-018",
      "title": "Clean up file naming artifacts and dead code",
      "description": "As a developer, I need the codebase free of merge artifacts and deprecated code so that the project is clean and navigable.",
      "acceptanceCriteria": [
        "Remove all *-PearsonASUS.ts files (these are merge/sync artifacts with duplicate functionality)",
        "Remove deprecated methods in EventDataEnhancer.tsx or consolidate them",
        "Verify no imports reference the removed files (search for PearsonASUS in all source files)",
        "Verify no runtime errors from the removals by checking that typecheck passes",
        "Typecheck passes"
      ],
      "priority": 18,
      "passes": true,
      "notes": "Completed: All 4 PearsonASUS artifact files deleted, 3 deprecated methods removed from EventDataEnhancer.tsx, no imports referenced the removed files, typecheck passes."
    },
    {
      "id": "US-019",
      "title": "Implement server-side user preferences storage",
      "description": "As a user, I need my preferences (theme, notifications, location) to persist across devices so that my experience is consistent regardless of which browser or device I use.",
      "acceptanceCriteria": [
        "Verify the user_preferences or user_profiles table exists with a preferences JSONB column (create migration if needed)",
        "Update the use-user-preferences.ts hook to sync preferences to Supabase when user is authenticated",
        "On login, load server-side preferences and merge with any localStorage preferences (server wins on conflict)",
        "On logout, continue using localStorage preferences only",
        "For unauthenticated users, continue using localStorage (graceful degradation)",
        "Resolve the TODO comment in use-user-preferences.ts",
        "Typecheck passes"
      ],
      "priority": 19,
      "passes": false,
      "notes": "Currently marked as TODO in use-user-preferences.ts. The profiles table has a preferences JSONB column that can be used."
    },
    {
      "id": "US-020",
      "title": "Implement scraping jobs database persistence",
      "description": "As an admin, I need scraping jobs persisted in the database so that job history, status, and results are tracked and queryable.",
      "acceptanceCriteria": [
        "Create a Supabase migration for scraping_jobs table with columns: id (UUID PK), job_type (text), status (text: pending/running/completed/failed/stopped), config (JSONB), results (JSONB), started_at (timestamptz), completed_at (timestamptz), created_by (UUID FK to auth.users), error_message (text)",
        "Add RLS policy: admins can CRUD, authenticated users can read their own jobs",
        "Update useScraping.ts to persist jobs to the scraping_jobs table instead of in-memory only",
        "Implement the stop job functionality (resolve the TODO at useScraping.ts:397)",
        "Resolve the TODO at useScraping.ts:483 for database persistence",
        "Typecheck passes"
      ],
      "priority": 20,
      "passes": false,
      "notes": "Two TODOs in useScraping.ts reference this. Without persistence, scraping jobs are lost on page refresh and there's no audit trail."
    },
    {
      "id": "US-021",
      "title": "Enable SearchTrafficDashboard in admin panel",
      "description": "As an admin, I need the search traffic dashboard enabled so that search analytics are visible and actionable.",
      "acceptanceCriteria": [
        "Investigate why SearchTrafficDashboard was commented out in Admin.tsx (check for missing table dependencies)",
        "Create any required database migrations for missing tables",
        "Uncomment and re-enable SearchTrafficDashboard in Admin.tsx",
        "Verify the component renders without runtime errors by checking typecheck and build",
        "Typecheck passes",
        "npm run build passes"
      ],
      "priority": 21,
      "passes": false,
      "notes": "SearchTrafficDashboard is commented out in Admin.tsx with a note about requiring database migrations not yet applied."
    },
    {
      "id": "US-022",
      "title": "Implement distance calculation in recommendation algorithm",
      "description": "As a user, I want event and restaurant recommendations that factor in distance from my location so that nearby options are prioritized.",
      "acceptanceCriteria": [
        "Create a Haversine distance calculation utility in src/lib/geo.ts",
        "Add unit test for the Haversine function with at least 3 test cases (known distances between Des Moines landmarks)",
        "Integrate distance calculation into the recommendation algorithm (resolve the TODO about distance calculation awaiting event coordinates)",
        "When user location is available, factor distance into recommendation scoring",
        "When user location is unavailable, gracefully skip distance factor",
        "Typecheck passes"
      ],
      "priority": 22,
      "passes": false,
      "notes": "TODO in recommendation algorithm awaits event coordinates. Many events now have latitude/longitude from the backfill-coordinates work."
    },
    {
      "id": "US-023",
      "title": "Add environment variable validation at startup",
      "description": "As a developer, I need environment variables validated at application startup so that missing configuration is caught immediately with clear error messages instead of causing cryptic runtime failures.",
      "acceptanceCriteria": [
        "Create src/lib/env.ts that validates required environment variables on import",
        "Required variables: VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY",
        "Optional variables with defaults: VITE_SITE_URL, VITE_SENTRY_DSN, VITE_STRIPE_PUBLISHABLE_KEY",
        "In development mode, log warnings for missing optional variables",
        "In production mode, throw an error for missing required variables",
        "Export typed env object for use throughout the app (replacing scattered import.meta.env calls)",
        "Import env.ts in main.tsx to trigger validation at startup",
        "Typecheck passes"
      ],
      "priority": 23,
      "passes": false,
      "notes": "Currently env vars are accessed via scattered import.meta.env calls with no validation. Missing vars cause silent failures at runtime."
    },
    {
      "id": "US-024",
      "title": "Optimize bundle size and remove unused dependencies",
      "description": "As a developer, I need the production bundle optimized so that initial page load is fast and meets the <500KB gzipped target.",
      "acceptanceCriteria": [
        "Run npm run build:analyze and document current bundle sizes",
        "Identify and remove unused dependencies from package.json (check for packages imported nowhere)",
        "Verify Puppeteer is NOT included in the client bundle (it should be devDependency or server-only)",
        "Ensure heavy libraries (Three.js, Leaflet, Tiptap, FullCalendar) are in separate lazy-loaded chunks",
        "After cleanup, run npm run build and verify bundle size is reduced",
        "Document final bundle sizes in a comment in vite.config.ts",
        "Typecheck passes",
        "npm run build passes"
      ],
      "priority": 24,
      "passes": false,
      "notes": "Target is <500KB gzipped initial bundle. Heavy libraries should already be chunk-split but Puppeteer may be leaking into the client bundle."
    },
    {
      "id": "US-025",
      "title": "Optimize database queries with missing indexes",
      "description": "As a developer, I need optimized database queries so that page loads are fast and the database performs well under production load.",
      "acceptanceCriteria": [
        "Create a Supabase migration adding composite indexes for common query patterns: (events: date + category, date + city), (restaurants: cuisine + city, rating DESC), (attractions: category + city)",
        "Add indexes for foreign key columns used in joins: favorites.user_id, favorites.event_id, ratings.user_id, reviews.entity_id",
        "Add partial index for upcoming events: WHERE date >= NOW()",
        "Add index for full-text search if not already present on events.title, restaurants.name",
        "Migration applies cleanly",
        "Typecheck passes"
      ],
      "priority": 25,
      "passes": false,
      "notes": "Some indexes exist (idx_events_date, idx_events_category, idx_restaurants_cuisine) but composite indexes for common filter combinations are likely missing."
    },
    {
      "id": "US-026",
      "title": "Complete WCAG 2.1 AA keyboard accessibility",
      "description": "As a user with motor disabilities, I need full keyboard navigation support so that I can use all features without a mouse.",
      "acceptanceCriteria": [
        "Verify skip navigation link exists and works (the test currently warns 'consider adding'). If missing, add <a href='#main-content' class='sr-only focus:not-sr-only'> at the top of the layout",
        "Add id='main-content' to the main content area in the root layout",
        "Ensure all modal/dialog components trap focus when open (check Dialog, Sheet, AlertDialog from shadcn/ui)",
        "Verify all interactive elements (buttons, links, inputs) have visible focus indicators (outline or ring)",
        "Add aria-label to icon-only buttons that lack visible text labels",
        "Typecheck passes"
      ],
      "priority": 26,
      "passes": false,
      "notes": "Accessibility tests exist but flag gaps. The skip link is the most commonly flagged issue. shadcn/ui components generally handle focus trapping well but need verification."
    },
    {
      "id": "US-027",
      "title": "Implement prefers-reduced-motion across all animations",
      "description": "As a user with vestibular disorders, I need animations to respect my OS motion preferences so that the site does not cause discomfort.",
      "acceptanceCriteria": [
        "Add a global CSS rule: @media (prefers-reduced-motion: reduce) that disables transitions and animations",
        "Specifically disable the 3D CityScape hero animation when reduced motion is preferred (check the Three.js/React Three Fiber component)",
        "Disable any scroll-triggered animations or parallax effects",
        "Disable auto-playing carousels or slideshows",
        "Create a useReducedMotion() hook in src/hooks/ that returns a boolean for component-level checks",
        "Typecheck passes"
      ],
      "priority": 27,
      "passes": false,
      "notes": "The 3D cityscape hero is the most prominent animation. Leaflet map transitions should also be considered."
    },
    {
      "id": "US-028",
      "title": "Implement feature flags system",
      "description": "As an operations engineer, I need a feature flags system so that new features can be deployed behind flags and toggled without code deployments.",
      "acceptanceCriteria": [
        "Create a Supabase migration for feature_flags table: id (UUID PK), flag_key (text UNIQUE), enabled (boolean default false), description (text), target_tiers (text[] for subscription tier targeting), created_at, updated_at",
        "Add RLS policy: public read, admin-only write",
        "Create src/hooks/useFeatureFlag.ts that fetches flag state from Supabase with TanStack Query caching (5 min stale time)",
        "Export useFeatureFlag(flagKey: string): { enabled: boolean, isLoading: boolean }",
        "Create a FeatureFlag wrapper component: <FeatureFlag flag='my-feature'><NewFeature /></FeatureFlag>",
        "Seed initial flags: 'search_traffic_dashboard', 'ai_trip_planner_v2', 'mobile_app_banner'",
        "Add unit test for useFeatureFlag hook",
        "Typecheck passes"
      ],
      "priority": 28,
      "passes": false,
      "notes": "Feature flags are essential for enterprise deployments. They allow progressive rollouts and instant rollbacks without redeploying code."
    },
    {
      "id": "US-029",
      "title": "Create API documentation for edge functions",
      "description": "As a developer, I need comprehensive API documentation so that edge functions can be understood, maintained, and consumed correctly.",
      "acceptanceCriteria": [
        "Create docs/API_REFERENCE.md documenting all 76 edge functions",
        "For each function, document: endpoint URL, HTTP method, authentication requirement (JWT/API key/none), request body schema, response schema, rate limit tier, example request/response",
        "Group functions by domain: Content (events/restaurants/attractions), Payment (Stripe), Data Processing (scrapers/crawlers), Analytics, AI/ML, Admin, Utility",
        "Note which functions are internal-only vs public-facing",
        "Typecheck passes"
      ],
      "priority": 29,
      "passes": false,
      "notes": "76 edge functions with no centralized API documentation. This is critical for onboarding developers and maintaining the system."
    },
    {
      "id": "US-030",
      "title": "Create production deployment runbook",
      "description": "As an operations engineer, I need a deployment runbook so that production deployments are safe, repeatable, and recoverable.",
      "acceptanceCriteria": [
        "Create docs/PRODUCTION_RUNBOOK.md with the following sections:",
        "Pre-deployment checklist: all CI checks pass, database migrations reviewed, env vars set, feature flags configured",
        "Deployment steps: Cloudflare Pages deployment via main branch push, Supabase migration deployment, edge function deployment",
        "Post-deployment verification: health check URLs, smoke test list (homepage, auth, events, restaurants, admin, payments), monitoring dashboard links",
        "Rollback procedures: Cloudflare Pages rollback (previous deployment), database migration rollback (down migration), edge function rollback (previous version)",
        "Incident response: severity levels (P1-P4), escalation contacts placeholder, communication templates",
        "Common issues and troubleshooting: Supabase connection issues, Stripe webhook failures, edge function timeouts",
        "Typecheck passes"
      ],
      "priority": 30,
      "passes": false,
      "notes": "DEPLOYMENT.md exists but is a basic guide. A production runbook is more comprehensive with operational procedures, rollback plans, and incident response."
    },
    {
      "id": "US-031",
      "title": "Replace window.location navigation with React Router useNavigate",
      "description": "As a user, I need seamless navigation that preserves app state so that clicking links does not cause full page reloads and lose my scroll position, form data, or component state.",
      "acceptanceCriteria": [
        "Search for all instances of window.location.href, window.location.reload(), and window.location.replace() in src/",
        "Replace each with useNavigate() from react-router-dom (navigate() for href, navigate(0) for reload where truly necessary)",
        "Remove any window.location.reload() calls that exist only to force state refresh — use React state or query invalidation instead",
        "Verify no runtime navigation errors by testing key flows: login, logout, admin panel, content table actions",
        "Typecheck passes",
        "npm run build passes"
      ],
      "priority": 31,
      "passes": false,
      "notes": "78+ instances of direct window.location usage bypass React Router, causing full page reloads that lose component state. Highest impact in AdminLogin, ContentTable, ProtectedRoute, and TrendingContent."
    },
    {
      "id": "US-032",
      "title": "Implement content interaction tracking for content_metrics table",
      "description": "As an admin, I need real content engagement data (clicks, favorites, shares) tracked in the content_metrics table so the Content Performance section of the analytics dashboard shows real data instead of empty charts.",
      "acceptanceCriteria": [
        "Create src/hooks/useContentTracking.ts that provides a trackContentEvent(contentId, contentType, metricType) function",
        "Integrate tracking into EventDetails, RestaurantDetails, and AttractionDetails pages for 'view' events",
        "Integrate tracking into favorite/unfavorite actions for 'favorite' events",
        "Integrate tracking into share actions for 'share' events",
        "Events are inserted into the content_metrics Supabase table",
        "Fire-and-forget pattern — tracking errors never block the UI",
        "Typecheck passes"
      ],
      "priority": 32,
      "passes": false,
      "notes": "The AdminAnalyticsDashboard already queries content_metrics for 'view' and 'click' metric_types. This story populates that table with real user interactions."
    },
    {
      "id": "US-033",
      "title": "Replace hardcoded metrics in AdminAnalyticsDashboard with real data",
      "description": "As an admin, I need the analytics dashboard to show real device breakdown, bounce rate, and session duration data so that I can make data-driven decisions about the platform.",
      "acceptanceCriteria": [
        "Calculate device breakdown from user_analytics.device_type field instead of using hardcoded percentages",
        "Calculate bounce rate from session data (sessions with only 1 page view / total sessions)",
        "Calculate average session duration from first and last event timestamps per session_id",
        "Remove all hardcoded placeholder values ('2m 30s', '42.5%', device percentages)",
        "Show 'Insufficient data' message when there are fewer than 10 sessions instead of misleading zeros",
        "Typecheck passes"
      ],
      "priority": 33,
      "passes": false,
      "notes": "Now that usePageTracking sends device_type and session_id data, the dashboard can compute these metrics from real data. Lines 164, 180-181, and 188-192 in AdminAnalyticsDashboard.tsx have the hardcoded values."
    },
    {
      "id": "US-034",
      "title": "Add email capture modal for free tool users",
      "description": "As a product owner, I need to capture email addresses from users of free tools (Trip Planner, Event Promotion Planner) so that we can build an email list for newsletters and re-engagement.",
      "acceptanceCriteria": [
        "Create src/components/EmailCaptureModal.tsx with email input, optional name field, and consent checkbox",
        "Modal appears after a user completes a key action (e.g., generates a trip itinerary or promotion timeline)",
        "Modal is dismissible and respects a 'do not show again' preference stored via safeStorage",
        "Captured emails are stored in a leads table in Supabase (create migration if needed)",
        "Include proper privacy disclosure linking to /privacy-policy",
        "Typecheck passes"
      ],
      "priority": 34,
      "passes": false,
      "notes": "Free tools are the primary lead generation channel. Currently there's no email capture outside the login flow. This is a high-impact conversion optimization."
    },
    {
      "id": "US-035",
      "title": "Implement offline detection and user notification",
      "description": "As a user, I need to know when I'm offline so that I understand why content isn't loading instead of seeing confusing error messages or blank pages.",
      "acceptanceCriteria": [
        "Create src/hooks/useNetworkStatus.ts that tracks navigator.onLine and online/offline events",
        "Create src/components/OfflineBanner.tsx that renders a non-intrusive banner at the top of the page when offline",
        "Banner includes a message like 'You appear to be offline. Some features may be unavailable.'",
        "Banner auto-dismisses when connection is restored",
        "Add the OfflineBanner to App.tsx so it appears globally",
        "Typecheck passes"
      ],
      "priority": 35,
      "passes": false,
      "notes": "Currently network errors show generic error messages. An explicit offline indicator prevents user confusion and reduces perceived bugs."
    },
    {
      "id": "US-036",
      "title": "Add search debouncing to event and restaurant listing pages",
      "description": "As a developer, I need search inputs debounced so that every keystroke does not trigger a database query, reducing server load and improving perceived performance.",
      "acceptanceCriteria": [
        "Create src/hooks/useDebouncedValue.ts that returns a debounced version of a value (300ms default delay)",
        "Apply debouncing to the search input in EventsPage.tsx",
        "Apply debouncing to the search input in Restaurants.tsx",
        "Apply debouncing to the search input in Attractions.tsx",
        "Verify that typing quickly only triggers one query after the user stops typing",
        "Typecheck passes"
      ],
      "priority": 36,
      "passes": false,
      "notes": "All keystrokes currently trigger immediate queries. With debouncing, typing 'farmers market' triggers 1 query instead of 14."
    },
    {
      "id": "US-037",
      "title": "Add admin audit trail for destructive operations",
      "description": "As a security-conscious admin, I need an audit log of destructive operations (delete, bulk update, role changes) so that there is accountability and the ability to investigate incidents.",
      "acceptanceCriteria": [
        "Create a Supabase migration for admin_audit_log table: id (UUID PK), admin_user_id (UUID FK), action (text), entity_type (text), entity_id (text), details (JSONB), created_at (timestamptz)",
        "Add RLS policy: admin-only read/write",
        "Create src/hooks/useAuditLog.ts that provides a logAdminAction(action, entityType, entityId, details) function",
        "Integrate audit logging into delete operations in the admin panel (event deletion, restaurant deletion, user role changes)",
        "Add an 'Audit Log' tab or section to the Admin dashboard that displays recent admin actions",
        "Typecheck passes"
      ],
      "priority": 37,
      "passes": false,
      "notes": "Currently there is no record of who deleted content or changed user roles. This is critical for multi-admin environments and incident investigation."
    },
    {
      "id": "US-038",
      "title": "Implement retry logic with exponential backoff for critical API calls",
      "description": "As a user, I need failed API requests to automatically retry so that transient network issues do not result in permanent failures and blank pages.",
      "acceptanceCriteria": [
        "Create src/lib/fetchWithRetry.ts that wraps fetch with configurable retry count (default 3) and exponential backoff (1s, 2s, 4s)",
        "Only retry on network errors and 5xx status codes, not on 4xx client errors",
        "Apply retry logic to TanStack Query's queryFn for critical data fetching hooks (useEvents, useRestaurants, useAttractions)",
        "Log retry attempts in development mode",
        "Typecheck passes"
      ],
      "priority": 38,
      "passes": false,
      "notes": "A single network hiccup currently causes permanent failure until the user manually refreshes. TanStack Query has built-in retry but it needs to be configured consistently across all hooks."
    },
    {
      "id": "US-039",
      "title": "Add conversion funnel tracking for subscription flow",
      "description": "As a product owner, I need visibility into where users drop off in the subscription funnel so that I can optimize conversion rates and identify UX friction points.",
      "acceptanceCriteria": [
        "Track funnel events: pricing_page_viewed, plan_selected, checkout_started, checkout_completed, checkout_abandoned",
        "Store funnel events in user_analytics with event_type prefix 'funnel_'",
        "Create src/components/admin/ConversionFunnelChart.tsx that visualizes the funnel with drop-off percentages",
        "Add the funnel chart to the admin analytics dashboard as a new tab",
        "Typecheck passes"
      ],
      "priority": 39,
      "passes": false,
      "notes": "The subscription system exists but there's no visibility into conversion rates. Without funnel data, optimizing the pricing page or checkout flow is guesswork."
    },
    {
      "id": "US-040",
      "title": "Implement A/B testing infrastructure with feature flags",
      "description": "As a product owner, I need the ability to run A/B tests so that UI changes, copy variations, and feature experiments can be measured against conversion metrics.",
      "acceptanceCriteria": [
        "Extend the feature_flags table (from US-028) with variant support: add variants JSONB column and traffic_split numeric column",
        "Create src/hooks/useExperiment.ts that assigns users to variants deterministically (based on user_id or session_id hash)",
        "Track variant assignment in user_analytics with event_type 'experiment_assigned'",
        "Create <Experiment flag='name' variants={{ A: <ComponentA />, B: <ComponentB /> }} /> wrapper component",
        "Typecheck passes"
      ],
      "priority": 40,
      "passes": false,
      "notes": "Depends on US-028 (feature flags). A/B testing is the key enabler for data-driven product decisions. Without it, all UI/UX changes are based on gut feeling."
    },
    {
      "id": "US-041",
      "title": "Build 'Des Best' crowdsourced local voting system",
      "description": "As a local resident, I need the ability to vote on 'Best Of' categories (Best Pizza, Best Coffee, Best Date Night, Best Hidden Gem, etc.) so that the platform reflects authentic local opinions and becomes the go-to source for crowdsourced recommendations — not Catch Des Moines.",
      "acceptanceCriteria": [
        "Create a Supabase migration for voting_categories table: id (UUID PK), name (text), slug (text UNIQUE), description (text), icon (text), is_active (boolean), voting_start (timestamptz), voting_end (timestamptz), created_at",
        "Create a Supabase migration for votes table: id (UUID PK), category_id (UUID FK), entity_type (text: restaurant/event/attraction/custom), entity_id (UUID nullable FK), custom_entry (text for write-in votes), user_id (UUID FK to auth.users), created_at, with UNIQUE constraint on (category_id, user_id) to prevent double-voting",
        "Create /best-of route page with category grid showing all active voting categories with vote counts",
        "Create /best-of/:category detail page showing ranked results with vote percentages and entity cards",
        "Create src/components/VotingBooth.tsx component with search-to-vote UX — user searches for a place, selects it, and casts vote",
        "Allow write-in votes for places not yet in the database",
        "Add RLS policies: authenticated users can vote once per category, public read for results",
        "Display 'Des Best' badge on winning entities across the platform (event cards, restaurant cards, etc.)",
        "Seed initial categories: Best Pizza, Best Coffee Shop, Best Happy Hour, Best Brunch, Best Date Night Spot, Best Hidden Gem, Best Food Truck, Best Brewery, Best Ice Cream, Best Live Music Venue",
        "Typecheck passes"
      ],
      "priority": 41,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines runs 'Des Best' with crowdsourced local voting that drives massive engagement. CITYVIEW's 'Best of Des Moines' gets 22,969+ votes across 271 categories annually. We have zero community voting. This is the single biggest engagement feature we're missing — locals vote, share results, and return to see who won. It turns passive readers into active participants."
    },
    {
      "id": "US-042",
      "title": "Create curated editorial itineraries with printable checklists",
      "description": "As a visitor planning a trip to Des Moines, I need pre-built themed itineraries (Weekend Getaway, Date Day, Family Fun, Art Walk, Craft Beer Trail, Foodie Tour) with printable checklists so that I can plan a trip without needing AI — just browse, pick, and go.",
      "acceptanceCriteria": [
        "Create a Supabase migration for curated_itineraries table: id (UUID PK), title (text), slug (text UNIQUE), description (text), duration (text: 'half-day'/'full-day'/'weekend'/'3-day'), theme (text), cover_image (text), stops (JSONB array of {order, entity_type, entity_id, name, description, time_suggestion, tips}), seo_title, seo_description, created_at, updated_at, is_published (boolean)",
        "Create /itineraries route page with itinerary cards organized by theme (Romance, Family, Adventure, Food & Drink, Arts & Culture, Sports)",
        "Create /itineraries/:slug detail page with step-by-step stop cards, embedded map showing route, time estimates between stops, and insider tips per stop",
        "Add print-friendly CSS with @media print styles that render a clean checklist version of the itinerary",
        "Add 'Download PDF' button that generates a printable itinerary using browser print-to-PDF",
        "Add 'Add All to Calendar' button that creates ICS entries for each stop with suggested times",
        "Seed at least 6 itineraries: Quintessential Weekend Getaway, Perfect Date Day, Family Fun Day, Craft Beer Trail, Downtown Art Walk, Foodie Tour",
        "Add Schema.org TouristTrip structured data to itinerary pages for SEO",
        "Typecheck passes"
      ],
      "priority": 42,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines has a full 'Catch List' itinerary system with downloadable/printable themed itineraries for Date Day, Family Fun, Quintessential Weekend, and more. Our AI Trip Planner is dynamic but many users just want to browse pre-built plans and print a checklist. Both approaches serve different user intents and should coexist."
    },
    {
      "id": "US-043",
      "title": "Build deals, coupons, and special offers section",
      "description": "As a budget-conscious visitor or local, I need a dedicated deals and coupons section so that I can find current discounts on restaurants, attractions, hotels, and activities — giving me a reason to check the platform before every outing.",
      "acceptanceCriteria": [
        "Create a Supabase migration for deals table: id (UUID PK), title (text), description (text), business_name (text), entity_type (text: restaurant/attraction/hotel/event), entity_id (UUID nullable FK), deal_type (text: percentage/dollar_off/bogo/free_item/package), discount_value (text), code (text nullable for promo codes), terms (text), start_date (timestamptz), end_date (timestamptz), image_url (text), is_verified (boolean), is_featured (boolean), redemption_count (integer default 0), created_at",
        "Create /deals route page with filterable deal cards organized by category (Dining, Attractions, Hotels, Activities)",
        "Add deal expiration countdown badges ('Expires in 3 days', 'Last day!', 'New this week')",
        "Add 'Claim Deal' button that reveals the promo code or instructions (increment redemption_count on claim)",
        "Allow business owners to submit deals via a self-service form at /deals/submit (requires authentication)",
        "Create src/components/DealCard.tsx with deal type badge, discount amount, business name, and expiry",
        "Add a 'Deals Near You' section to the homepage that shows 3-4 featured deals",
        "Add RLS policies: public read, business_owner/admin write",
        "Typecheck passes"
      ],
      "priority": 43,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines has a dedicated deals/coupons section for attractions, hotels, and restaurants. We have zero deals functionality. Deals create urgency, repeat visits, and direct business value for partners. This also creates a monetization path — businesses pay to feature deals prominently."
    },
    {
      "id": "US-044",
      "title": "Create interactive city discovery map with all content layers",
      "description": "As a visitor or local exploring Des Moines, I need a full-screen interactive map showing events, restaurants, attractions, and playgrounds as toggleable layers so that I can visually discover what's near me or plan a route through the city.",
      "acceptanceCriteria": [
        "Create /map route page with a full-screen Leaflet map centered on Des Moines (41.5868, -93.6250)",
        "Add toggleable map layers: Events (calendar icon), Restaurants (fork icon), Attractions (star icon), Playgrounds (swing icon), Hotels (bed icon)",
        "Each marker shows a popup card with entity name, image thumbnail, key info (rating, price, date), and 'View Details' link",
        "Add cluster markers when zoomed out to prevent marker overload (use Leaflet.markercluster)",
        "Add 'Near Me' button that centers map on user's geolocation and highlights nearby entities within configurable radius (0.5mi, 1mi, 5mi)",
        "Add category filter sidebar/bottom sheet (mobile) to filter markers by type, price range, rating, cuisine, etc.",
        "Add 'Get Directions' button on each popup that opens Google Maps/Apple Maps with the destination",
        "Lazy load the map component and marker data to avoid impacting initial page load",
        "Typecheck passes"
      ],
      "priority": 44,
      "passes": false,
      "notes": "COMPETITIVE GAP: Best-in-class tourism sites (Zurich, NYCGo, Visit Australia) all feature prominent interactive maps as primary discovery tools. We have Leaflet maps embedded in individual pages but no central 'explore by map' experience. Catch Des Moines doesn't have this either — this is an opportunity to leapfrog them."
    },
    {
      "id": "US-045",
      "title": "Build dedicated live music and concert hub with 'The Setlist' monthly feature",
      "description": "As a music fan in Des Moines, I need a dedicated live music section with venue guides, tonight's shows, and a curated monthly 'Setlist' feature so that I never miss a great show — and I stop going to Catch Des Moines for their concert calendar.",
      "acceptanceCriteria": [
        "Create /music route page with sections: Tonight's Shows, This Weekend's Shows, Upcoming Concerts, Venue Guide",
        "Create a Supabase migration for venues table: id (UUID PK), name (text), slug (text UNIQUE), description (text), address (text), capacity (integer), venue_type (text: arena/theater/bar/club/outdoor), image_url (text), website (text), latitude (numeric), longitude (numeric), created_at",
        "Create /music/venues/:slug venue detail page showing upcoming events at that venue, venue info, photos, and map",
        "Add 'The Setlist' monthly feature section — an editable curated list of the top 10-15 must-see shows each month, stored as a JSONB column in a monthly_features table",
        "Filter events by category='Music' or category='Concert' with additional genre tags (Rock, Country, Jazz, Hip-Hop, Electronic, Classical)",
        "Add venue map showing all music venues in Des Moines with tonight's shows highlighted",
        "Add 'Set Reminder' button on each show that triggers the existing EventReminderSettings flow",
        "Seed venue data for major Des Moines venues: Wells Fargo Arena, Hoyt Sherman Place, Wooly's, xBk, Lefty's, Val Air Ballroom, Des Moines Civic Center, Simon Estes Amphitheater",
        "Typecheck passes"
      ],
      "priority": 45,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines has 'The Setlist' — a monthly curated feature highlighting the best concerts each month, plus dedicated venue pages and a concert calendar. We lump music into general events with no venue context, no curation, and no genre filtering. Des Moines has a thriving music scene and this deserves its own hub."
    },
    {
      "id": "US-046",
      "title": "Build dedicated sports hub with team schedules and tailgating guides",
      "description": "As a sports fan visiting or living in Des Moines, I need a dedicated sports section with team schedules, venue guides, and tailgating tips so that I can plan my gameday experience — Des Moines is the #1 minor league market in the country and we should own that narrative.",
      "acceptanceCriteria": [
        "Create /sports route page with sections: Today's Games, This Week's Schedule, Teams & Venues, Tailgating Guide",
        "Create a Supabase migration for teams table: id (UUID PK), name (text), slug (text UNIQUE), sport (text), league (text), venue_name (text), venue_id (UUID nullable FK to venues), logo_url (text), website (text), schedule_url (text), description (text), created_at",
        "Create /sports/:slug team detail page with upcoming games, venue info, fan tips, and nearby restaurants/bars",
        "Add 'Gameday Guide' content blocks for each venue with parking tips, best food options, pre-game bars, and post-game hangouts",
        "Seed team data: Iowa Cubs (AAA Baseball), Iowa Wild (AHL Hockey), Iowa Wolves (NBA G-League), Iowa Barnstormers (IFL), Des Moines Menace (USL League Two), Drake Bulldogs, Grand View Vikings",
        "Add sports-specific event filtering to pull games from the events table by category",
        "Add Schema.org SportsEvent structured data to game event pages",
        "Typecheck passes"
      ],
      "priority": 46,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines has a dedicated sports section positioning Des Moines as the #1 minor league market in the US. They cover Iowa Cubs, Iowa Wild, Iowa Barnstormers, Iowa Wolves, and Des Moines Menace with venue guides and fan experiences. Our events include sports but there's no dedicated sports hub, no team pages, no gameday guides. Sports fans need a specialized experience."
    },
    {
      "id": "US-047",
      "title": "Create trails and outdoor recreation hub",
      "description": "As an outdoor enthusiast in Des Moines, I need a dedicated trails and outdoor recreation section with trail maps, difficulty ratings, and seasonal recommendations so that I can explore the 800+ miles of trails in the metro area.",
      "acceptanceCriteria": [
        "Create a Supabase migration for trails table: id (UUID PK), name (text), slug (text UNIQUE), description (text), length_miles (numeric), difficulty (text: easy/moderate/difficult), surface_type (text: paved/gravel/dirt), activities (text[] for hiking/biking/running/walking), highlights (text), trailhead_address (text), latitude (numeric), longitude (numeric), image_url (text), website (text), is_featured (boolean), created_at",
        "Create /outdoors route page with sections: Featured Trails, Trail Map, Outdoor Activities, Seasonal Guides",
        "Create /outdoors/:slug trail detail page with trail info, photos, difficulty badge, map with trail overlay, nearby amenities",
        "Add an interactive trail map showing all trails with color-coded difficulty and activity type filters",
        "Seed trail data for major trails: High Trestle Trail, Raccoon River Valley Trail, Gray's Lake Loop, Clive Greenbelt Trail, Sycamore Trails, Neal Smith Trail, Great Western Trail, Bill Riley Trail",
        "Add seasonal outdoor activity guides (Spring: biking season openers, Summer: water activities, Fall: foliage hikes, Winter: cross-country skiing)",
        "Add 'Trail Conditions' section with weather integration showing current conditions and best time to visit",
        "Typecheck passes"
      ],
      "priority": 47,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines has extensive hiking/biking trail content. DSM Partnership promotes 800+ miles of trails. Explore Des Moines publishes seasonal trail guides. We have attractions but zero dedicated trail/outdoor content. Des Moines' trail system (especially High Trestle Trail) is a nationally recognized attraction that deserves its own hub."
    },
    {
      "id": "US-048",
      "title": "Build brewery and craft beer trail experience",
      "description": "As a craft beer enthusiast, I need a brewery trail feature with a digital passport so that I can discover Des Moines breweries, track my visits, earn rewards, and complete the trail — turning brewery hopping into a gamified adventure.",
      "acceptanceCriteria": [
        "Create /breweries route page filtering restaurants where cuisine includes 'Brewery' or 'Craft Beer', with additional brewery-specific fields",
        "Create a Supabase migration for brewery_trail_checkins table: id (UUID PK), user_id (UUID FK), restaurant_id (UUID FK), checked_in_at (timestamptz), photo_url (text nullable), beer_name (text nullable), rating (integer 1-5 nullable)",
        "Create a digital 'Brewery Passport' component showing all trail breweries as stamps — filled when checked in, empty when not visited",
        "Add check-in functionality with optional photo upload and beer rating",
        "Award gamification XP (40 XP) for each brewery check-in, plus bonus badge for completing the full trail",
        "Create /breweries/trail map page showing all breweries on an interactive map with check-in status overlay",
        "Add 'Brewery Trail Progress' widget to user dashboard showing X of Y breweries visited",
        "Seed brewery data: Confluence Brewing, Exile Brewing, Peace Tree Brewing, Firetrucker Brewery, Brightside Aleworks, 515 Brewing, Mistress Brewing, Fox Brewing, Kinship Brewing",
        "Typecheck passes"
      ],
      "priority": 48,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines promotes craft beer trails. Des Moines has a booming craft beer scene. We list restaurants but have no brewery-specific experience and no 'trail' gamification. The digital passport concept combines our existing gamification system with brewery discovery — something no competitor does digitally."
    },
    {
      "id": "US-049",
      "title": "Build transportation and getting around guide",
      "description": "As a visitor to Des Moines, I need a comprehensive transportation guide covering parking, the skywalk system, bike share, rideshare, airport info, and transit so that I can navigate the city confidently without a car or know exactly where to park if I drive.",
      "acceptanceCriteria": [
        "Create /getting-around route page with sections: Parking & ParkDSM, Skywalk System, Bike Share (BCycle), Rideshare, Airport (DSM), Public Transit (DART), Walking Distances",
        "Add an interactive downtown parking map showing garage locations, rates, and hours using Leaflet markers",
        "Add skywalk system map showing connected buildings and walkable routes (important for Iowa winters)",
        "Add BCycle station locations on the map with station info",
        "Include airport guide section: terminal info, airline list, ground transportation options, drive time to downtown",
        "Add 'Distance From Downtown' reference table for popular destinations with drive times and transit options",
        "Add Schema.org FAQ structured data for common transportation questions ('Is there Uber in Des Moines?', 'Where to park downtown?', 'Does Des Moines have a subway?')",
        "Typecheck passes"
      ],
      "priority": 49,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines has detailed transportation pages covering ParkDSM app, skywalk system (4+ miles of enclosed walkways), BCycle, airport info, and transit. We have zero transportation content. This is essential visitor info — especially the skywalk system which is unique to Des Moines and critical during winter months."
    },
    {
      "id": "US-050",
      "title": "Create downloadable and requestable digital visitor guide",
      "description": "As a visitor planning a trip to Des Moines, I need a downloadable digital visitor guide (PDF) and the option to request a physical copy so that I have a comprehensive offline reference for my trip.",
      "acceptanceCriteria": [
        "Create /visitors-guide route page with hero image, guide description, and download/request options",
        "Generate a PDF visitor guide using the platform's content: top events, restaurant picks, attraction highlights, neighborhood guides, maps, and insider tips",
        "Add 'Download Digital Guide' button that serves the PDF and captures email address (lead generation)",
        "Add 'Request Free Guide' form that collects name, email, and mailing address for physical guide fulfillment",
        "Store guide requests in a Supabase guide_requests table for fulfillment tracking",
        "Create a seasonal/annual refresh process — guide content should pull from current platform data",
        "Add Schema.org TouristInformationCenter structured data",
        "Track downloads and requests in analytics for conversion metrics",
        "Typecheck passes"
      ],
      "priority": 50,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines offers a beautiful annual Visitors Guide (2026 edition now available) as both digital download and free mailed copy. It's a massive lead generation and brand credibility tool. We have no equivalent. Even a well-designed PDF guide auto-generated from our content would be valuable."
    },
    {
      "id": "US-051",
      "title": "Build meeting planner and group travel portal",
      "description": "As a meeting planner or group travel organizer, I need a dedicated portal with venue search by capacity, RFP submission, and group itinerary tools so that I can plan conferences, weddings, and group trips to Des Moines through our platform.",
      "acceptanceCriteria": [
        "Create /group-travel route page with sections: Meeting Venues, Wedding Venues, Group Itineraries, Submit RFP, Why Des Moines",
        "Create a Supabase migration for meeting_venues table: id (UUID PK), name (text), venue_type (text: conference_center/hotel/unique_venue/outdoor), max_capacity (integer), min_capacity (integer), sq_footage (integer nullable), amenities (text[]), catering (text: in_house/external/both), av_equipment (boolean), website (text), contact_email (text), image_url (text), latitude, longitude, created_at",
        "Add venue search with filters: capacity range, venue type, amenities, catering options",
        "Create /group-travel/rfp page with an RFP submission form: event name, dates, expected attendance, venue requirements, budget range, contact info",
        "Store RFP submissions in a Supabase rfp_submissions table and send email notification to admin",
        "Add group-specific itinerary suggestions linking to curated itineraries from US-042",
        "Add 'Why Des Moines' section with stats: central location, affordable, award-winning food scene, 800+ miles of trails",
        "Typecheck passes"
      ],
      "priority": 51,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines has an entire Meeting Planners section with RFP submission, venue search by capacity, destination services, and wedding planning. This is a major B2B revenue driver for them. We have zero B2B meeting/convention features. The Des Moines convention business is significant — Iowa Events Center, Community Choice Credit Union Convention Center, etc."
    },
    {
      "id": "US-052",
      "title": "Add seasonal and holiday event guides with editorial curation",
      "description": "As a local or visitor, I need seasonal and holiday-specific event guides (Summer Activities, Fall Festivals, Holiday Lights, Valentine's Day, St. Patrick's Day, etc.) so that I can find the best seasonal experiences without scrolling through the full events calendar.",
      "acceptanceCriteria": [
        "Create a Supabase migration for seasonal_guides table: id (UUID PK), title (text), slug (text UNIQUE), season (text: spring/summer/fall/winter/holiday), description (text), cover_image (text), content (JSONB with sections for featured_events, activities, tips), is_published (boolean), publish_date (timestamptz), seo_title, seo_description, created_at",
        "Create /guides/:slug route page with editorial content, featured events grid, curated activity lists, and insider tips",
        "Update the existing /guides page to dynamically pull from seasonal_guides table instead of hardcoded content",
        "Add seasonal banner to homepage that promotes the current season's guide",
        "Seed at least 4 guides: Summer in Des Moines, Fall Festivals & Foliage, Holiday Lights & Markets, Iowa State Fair Survival Guide",
        "Add event tagging for seasonal association (events can be tagged with seasonal_guide_id)",
        "Add Schema.org Article structured data to guide pages",
        "Typecheck passes"
      ],
      "priority": 52,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines publishes seasonal content heavily — summer activity guides, fall festival roundups, holiday event guides. We have a guides page but it's mostly static. Seasonal editorial content drives massive organic traffic from searches like 'things to do in Des Moines this summer' and 'Des Moines holiday events 2026'."
    },
    {
      "id": "US-053",
      "title": "Create neighborhood deep-dive pages with local insider content",
      "description": "As someone exploring Des Moines neighborhoods, I need rich neighborhood pages with walking tour routes, local business spotlights, history, and 'insider secrets' so that I can experience each neighborhood like a local — not just see a list of restaurants.",
      "acceptanceCriteria": [
        "Enhance existing /neighborhoods/:slug pages with: neighborhood history section, walking tour route (map with numbered stops), 'Insider Secrets' tips from locals, photo gallery, demographic/vibe description",
        "Add a Supabase migration for neighborhood_content table: id (UUID PK), neighborhood_slug (text), content_type (text: history/walking_tour/insider_tip/photo), content (JSONB), author (text nullable), created_at",
        "Add walking tour functionality with ordered stops plotted on a Leaflet map with step-by-step directions",
        "Add 'Local's Pick' badge on businesses that are neighborhood favorites (based on ratings or editorial selection)",
        "Add cross-linking between neighborhoods and their events, restaurants, and attractions using location data",
        "Create a 'Neighborhood Spotlight' rotating feature on the homepage highlighting one neighborhood per week",
        "Add content for at least 4 neighborhoods: East Village, Historic Valley Junction, Drake Neighborhood, Beaverdale",
        "Typecheck passes"
      ],
      "priority": 53,
      "passes": false,
      "notes": "COMPETITIVE GAP: DSM Partnership publishes neighborhood guides with near-neighborhood deep-dives. Catch Des Moines features neighborhood-specific content. Explore Des Moines runs neighborhood events like 'Eat.Drink.Architecture' walking tours. Our neighborhood pages exist but are thin — mostly entity counts. Rich neighborhood content is a massive SEO play for hyper-local searches."
    },
    {
      "id": "US-054",
      "title": "Build food and drink editorial hub with 'Restaurant Week' and curated lists",
      "description": "As a foodie in Des Moines, I need a dedicated food and drink editorial hub with curated 'Best Of' lists, Restaurant Week coverage, chef spotlights, and food scene news so that this platform becomes the definitive Des Moines dining resource — not dsm Magazine or Catch Des Moines.",
      "acceptanceCriteria": [
        "Create /food-drink route page with sections: Best Of Lists, Restaurant Week, Chef Spotlights, New Openings, Food Trucks, Dining Guides",
        "Create a Supabase migration for food_lists table: id (UUID PK), title (text), slug (text UNIQUE), description (text), list_type (text: best_of/new_openings/closing/chef_spotlight), items (JSONB array of {restaurant_id, name, description, why_its_great, image_url}), cover_image (text), author (text), is_published (boolean), publish_date (timestamptz), seo_title, seo_description",
        "Seed curated lists: Best Pizza in Des Moines, Best Coffee Shops, Best Brunch Spots, Best Happy Hours, Best Food Trucks, Best Hidden Gem Restaurants, Best Date Night Restaurants",
        "Create /food-drink/new-openings page that auto-generates from restaurants added in the last 30 days",
        "Add 'Restaurant Week' event section that links featured participating restaurants during active Restaurant Week periods",
        "Add internal cross-linking from curated lists to individual restaurant pages for SEO link juice",
        "Typecheck passes"
      ],
      "priority": 54,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines has extensive 'Des Best' food content (Best Pizza, Best Ice Cream, Best Coffee, Best Happy Hours, Best Food Trucks). dsm Magazine runs Restaurant Week with dozens of participating venues. We have restaurant listings but zero editorial food content — no curated lists, no new opening alerts, no chef spotlights. Food content is the #1 traffic driver for city guide sites."
    },
    {
      "id": "US-055",
      "title": "Implement real-time weather integration with activity suggestions",
      "description": "As a visitor or local checking the platform, I need to see current weather conditions with smart activity suggestions so that I can plan my day based on what's actually happening outside — rainy day indoor activities, perfect patio weather alerts, etc.",
      "acceptanceCriteria": [
        "Create src/hooks/useWeather.ts that fetches current weather and 5-day forecast from a free weather API (OpenWeatherMap or WeatherAPI) for Des Moines",
        "Create src/components/WeatherWidget.tsx displaying current temp, conditions, and icon in the header or homepage hero",
        "Add 'Perfect For Today' activity suggestions based on weather: rainy day -> indoor attractions/museums, sunny warm -> patios/trails/outdoor events, cold -> skywalk activities/indoor venues",
        "Create a weather-aware filter on event and attraction pages: 'Show indoor only' toggle when weather is poor",
        "Cache weather data for 30 minutes to minimize API calls (use TanStack Query staleTime)",
        "Add weather context to AI Trip Planner so generated itineraries account for forecast conditions",
        "Add VITE_WEATHER_API_KEY to .env.example",
        "Typecheck passes"
      ],
      "priority": 55,
      "passes": false,
      "notes": "COMPETITIVE GAP: No Des Moines competitor currently does this well, but best-in-class tourism sites worldwide integrate weather with activity suggestions. This is especially valuable in Iowa where weather varies dramatically and impacts plans. Our AI mentions weather context but we don't display actual weather data or adapt recommendations to current conditions."
    },
    {
      "id": "US-056",
      "title": "Build loyalty rewards program with partner business redemption",
      "description": "As a regular platform user, I need the ability to redeem my earned XP and badges for real rewards (discounts at partner restaurants, free attraction tickets, exclusive experiences) so that my engagement has tangible value beyond virtual points.",
      "acceptanceCriteria": [
        "Create a Supabase migration for rewards table: id (UUID PK), title (text), description (text), partner_business (text), reward_type (text: discount/free_item/experience/early_access), xp_cost (integer), quantity_available (integer nullable), quantity_redeemed (integer default 0), terms (text), expiry_date (timestamptz nullable), image_url (text), is_active (boolean), created_at",
        "Create a Supabase migration for reward_redemptions table: id (UUID PK), reward_id (UUID FK), user_id (UUID FK), redeemed_at (timestamptz), redemption_code (text UNIQUE), status (text: pending/used/expired)",
        "Create /rewards route page showing available rewards with XP cost, organized by category",
        "Add 'Redeem' button that deducts XP from user account, generates a unique redemption code, and displays it to the user",
        "Create src/components/RewardCard.tsx showing reward details, XP cost, availability, and partner branding",
        "Add 'My Rewards' section to user dashboard showing active redemption codes and history",
        "Add RLS policies: public read for rewards, authenticated users can redeem, admin can manage",
        "Seed example rewards to demonstrate the system (even if partner agreements aren't yet in place)",
        "Typecheck passes"
      ],
      "priority": 56,
      "passes": false,
      "notes": "COMPETITIVE GAP: Industry trend — Viator and Booking.com have loyalty programs with real rewards. Our gamification system awards XP and badges but they're purely cosmetic. Adding real redemption value transforms gamification from a novelty into a retention driver. This also creates a compelling pitch for business partnerships — 'get your offer in front of our most engaged users.'"
    },
    {
      "id": "US-057",
      "title": "Add food truck tracker with real-time locations",
      "description": "As a food truck fan in Des Moines, I need a real-time food truck tracker showing where trucks are today, their menus, and their weekly schedules so that I can find my favorites without hunting through social media.",
      "acceptanceCriteria": [
        "Create a Supabase migration for food_trucks table: id (UUID PK), name (text), slug (text UNIQUE), description (text), cuisine (text), phone (text nullable), website (text nullable), social_media (JSONB), image_url (text), menu_url (text nullable), is_active (boolean), created_at",
        "Create a Supabase migration for food_truck_locations table: id (UUID PK), truck_id (UUID FK), date (date), location_name (text), address (text), latitude (numeric), longitude (numeric), start_time (time), end_time (time), notes (text nullable), created_at",
        "Create /food-trucks route page with today's active trucks on a map and a list view",
        "Create /food-trucks/:slug detail page with truck info, menu, weekly schedule, and location history",
        "Add map view with truck markers showing today's locations with popup cards",
        "Allow food truck owners to self-update their daily locations via authenticated form",
        "Add 'Follow' button to get notified when a favorite truck posts a new location",
        "Typecheck passes"
      ],
      "priority": 57,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines has a 'Best Food Trucks' feature. Food truck culture is huge in Des Moines (especially at events like Downtown Farmers Market). No competitor offers real-time food truck tracking. Most truck fans currently rely on following individual trucks on Instagram/Facebook. Centralizing this creates a unique utility that competitors can't match."
    },
    {
      "id": "US-058",
      "title": "Create 'What's New in DSM' feed with new openings, closings, and scene updates",
      "description": "As a local who wants to stay in the loop, I need a news feed of what's new in Des Moines — new restaurant openings, business closings, construction updates, and scene changes — so that I have a reason to check the platform daily.",
      "acceptanceCriteria": [
        "Create a Supabase migration for scene_updates table: id (UUID PK), title (text), body (text), update_type (text: new_opening/closing/renovation/expansion/news), entity_type (text: restaurant/attraction/venue/neighborhood nullable), entity_id (UUID nullable FK), image_url (text nullable), source_url (text nullable), neighborhood (text nullable), is_published (boolean), publish_date (timestamptz), author (text), created_at",
        "Create /whats-new route page with a chronological feed of scene updates, filterable by type and neighborhood",
        "Create src/components/SceneUpdateCard.tsx with update type badge (New!, Closing, Under Renovation), entity link, and timestamp",
        "Add 'What's New' section to homepage showing the 3 most recent updates",
        "Auto-generate 'New Opening' updates when a new restaurant or attraction is added to the database (via Supabase trigger or edge function)",
        "Add email digest integration — include recent scene updates in weekly newsletter",
        "Add RSS feed endpoint at /whats-new/feed.xml for syndication",
        "Typecheck passes"
      ],
      "priority": 58,
      "passes": false,
      "notes": "COMPETITIVE GAP: This is a gap across ALL competitors. None of them do real-time scene tracking well. dsm Magazine covers new openings editorially but not in real-time. We already detect new restaurant openings within 48 hours via our scrapers — we should surface this intelligence to users directly. A daily-updated 'What's New' feed creates habitual platform usage."
    },
    {
      "id": "US-059",
      "title": "Build comprehensive hotel and lodging section with booking integration",
      "description": "As a visitor looking for accommodation in Des Moines, I need a hotel section with comparison filters, neighborhood guides, package deals, and booking links so that I can find and book the right place to stay without leaving the platform.",
      "acceptanceCriteria": [
        "Enhance existing /stay page with richer hotel cards: star rating, price range indicator, neighborhood, amenities badges, distance from downtown",
        "Add filters: price range, star rating, neighborhood, amenities (pool, fitness, parking, pet-friendly, restaurant on-site)",
        "Add 'Hotels by Neighborhood' grouping so visitors can choose based on where they want to be",
        "Add 'Book Now' affiliate links to booking platforms (Booking.com, Hotels.com, or direct hotel sites) — this creates affiliate revenue",
        "Add 'Hotel + Event' package suggestion: when viewing an event, suggest nearby hotels with 'Stay nearby' call-to-action",
        "Add hotel comparison feature: select 2-3 hotels and see a side-by-side comparison table",
        "Add Schema.org Hotel structured data with priceRange and aggregateRating",
        "Typecheck passes"
      ],
      "priority": 59,
      "passes": false,
      "notes": "COMPETITIVE GAP: Catch Des Moines has robust hotel content with featured hotels, packages, and deals. Our /stay page exists but is thin compared to what visitors need when planning a trip. Hotel affiliate links are a proven revenue stream for city guide sites. The 'Hotel + Event' pairing suggestion is something no competitor does and leverages our event data advantage."
    },
    {
      "id": "US-060",
      "title": "Add multilingual support starting with Spanish",
      "description": "As a Spanish-speaking visitor or resident of Des Moines, I need the platform available in Spanish so that I can discover events, restaurants, and activities in my preferred language — reflecting the growing Latino community in Des Moines.",
      "acceptanceCriteria": [
        "Install and configure react-i18next with language detection (browser language, URL parameter, user preference)",
        "Create src/i18n/ directory with en.json and es.json translation files",
        "Translate core UI strings: navigation, buttons, labels, error messages, filter options, footer (approximately 200-300 strings)",
        "Add language toggle button to the header/nav (EN | ES)",
        "Store language preference in user profile (authenticated) or safeStorage (anonymous)",
        "Add hreflang meta tags for SEO: <link rel='alternate' hreflang='es' href='...' />",
        "Use translation keys in at least 10 core pages: homepage, events, restaurants, attractions, search, auth, profile, pricing, contact, about",
        "AI-generated content (event descriptions, restaurant descriptions) remains in source language with a 'Translate' button that uses browser translation API",
        "Typecheck passes"
      ],
      "priority": 60,
      "passes": false,
      "notes": "COMPETITIVE GAP: Best-in-class tourism sites offer multilingual support. No Des Moines competitor currently offers Spanish language support despite Des Moines' significant and growing Latino population (~13% of Polk County). This is both a competitive differentiator and an accessibility/inclusion win. Start with Spanish, architect for future language additions."
    }
  ]
}
