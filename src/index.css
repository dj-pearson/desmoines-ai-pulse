@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* Des Moines Pulse - Global Palette */
    /* Des Moines Blue: #071e62 -> HSL(225, 87%, 21%) */
    /* Des Moines Red: #c30e31 -> HSL(348, 87%, 41%) */

    --background: 0 0% 100%;
    --foreground: 225 87% 10%;
    /* Deep blue-black for text */

    --card: 0 0% 100%;
    --card-foreground: 225 87% 10%;

    --popover: 0 0% 100%;
    --popover-foreground: 225 87% 10%;

    /* Primary: Des Moines Blue */
    --primary: 225 87% 21%;
    --primary-foreground: 0 0% 100%;
    --primary-hover: 225 87% 16%;
    --primary-light: 225 87% 90%;

    /* Secondary: Des Moines Red */
    --secondary: 348 87% 41%;
    --secondary-foreground: 0 0% 100%;
    --secondary-hover: 348 87% 36%;

    /* Neutral grays - Cool toned to match blue */
    --muted: 225 20% 96%;
    --muted-foreground: 225 20% 40%;

    --accent: 225 20% 96%;
    --accent-foreground: 225 87% 21%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;

    --warning: 38 92% 50%;
    --warning-foreground: 225 87% 10%;

    --border: 225 20% 90%;
    --input: 225 20% 90%;
    --ring: 225 87% 21%;

    --radius: 0.75rem;

    /* Mobile spacing system */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;

    /* Mobile touch targets */
    --touch-target: 44px;

    /* Performance-optimized shadows */
    --shadow-sm: 0 1px 2px 0 hsl(225 50% 10% / 0.05);
    --shadow-md: 0 4px 6px -1px hsl(225 50% 10% / 0.1);
    --shadow-lg: 0 10px 15px -3px hsl(225 50% 10% / 0.1);

    /* Accessibility utilities */
    --focus-ring: 2px solid hsl(var(--primary));
    --focus-ring-offset: 2px;

    --sidebar-background: 225 30% 98%;
    --sidebar-foreground: 225 87% 10%;
    --sidebar-primary: 225 87% 21%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 225 20% 94%;
    --sidebar-accent-foreground: 225 87% 21%;
    --sidebar-border: 225 20% 90%;
    --sidebar-ring: 225 87% 21%;
  }

  .dark {
    /* Dark Mode - Deep Rich Blue Theme */
    --background: 225 50% 5%;
    /* Very dark blue, almost black */
    --foreground: 225 20% 98%;

    --card: 225 50% 8%;
    --card-foreground: 225 20% 98%;

    --popover: 225 50% 8%;
    --popover-foreground: 225 20% 98%;

    /* Primary: Des Moines Blue (Lightened slightly for dark mode visibility) */
    --primary: 225 87% 60%;
    --primary-foreground: 225 87% 10%;
    --primary-hover: 225 87% 65%;
    --primary-light: 225 87% 20%;

    /* Secondary: Des Moines Red */
    --secondary: 348 87% 55%;
    /* Slightly brighter for dark mode */
    --secondary-foreground: 0 0% 100%;
    --secondary-hover: 348 87% 60%;

    --muted: 225 30% 15%;
    --muted-foreground: 225 20% 70%;

    --accent: 225 30% 15%;
    --accent-foreground: 225 20% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 225 20% 98%;

    --warning: 38 92% 60%;
    --warning-foreground: 225 87% 10%;

    --border: 225 30% 15%;
    --input: 225 30% 15%;
    --ring: 225 87% 60%;

    --sidebar-background: 225 50% 6%;
    --sidebar-foreground: 225 20% 98%;
    --sidebar-primary: 225 87% 60%;
    --sidebar-primary-foreground: 225 87% 10%;
    --sidebar-accent: 225 30% 15%;
    --sidebar-accent-foreground: 225 20% 98%;
    --sidebar-border: 225 30% 15%;
    --sidebar-ring: 225 87% 60%;
  }
}

@layer base {
  /* WCAG 1.4.3 - Ensure placeholder text meets 3:1 minimum contrast */
  ::placeholder {
    opacity: 0.65;
  }
}

@layer utilities {
  .glass {
    @apply bg-white/70 backdrop-blur-lg border border-white/20 shadow-lg;
  }

  .glass-dark {
    @apply bg-black/40 backdrop-blur-lg border border-white/10 shadow-lg;
  }

  .glass-card {
    @apply bg-white/80 dark:bg-black/40 backdrop-blur-md border border-white/20 dark:border-white/10 shadow-sm hover:shadow-md transition-all duration-300;
  }

  .text-gradient {
    @apply bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary;
  }

  .text-gradient-blue {
    @apply bg-clip-text text-transparent bg-gradient-to-r from-[#071e62] to-[#0a2a8a] dark:from-[#4d7cfe] dark:to-[#071e62];
  }
}

/* Mobile-First Design System - Optimized for GEO and Performance
All colors MUST be HSL. Touch targets minimum 44px.
*/

/* Critical CSS for mobile performance */
@layer utilities {

  /* Mobile-first touch targets */
  .touch-target {
    @apply min-h-[44px] min-w-[44px];
  }

  /* Mobile-optimized spacing */
  .mobile-padding {
    @apply px-4 py-3;
  }

  .mobile-margin {
    @apply mx-4 my-3;
  }

  /* Performance-optimized animations and micro-interactions */
  .smooth-transition {
    @apply transition-all duration-200 ease-out;
  }

  /* Micro-interaction utilities */
  .interactive-scale {
    @apply transition-transform duration-200 ease-out hover:scale-105 active:scale-95;
  }

  .interactive-lift {
    @apply transition-all duration-200 ease-out hover:shadow-lg hover:-translate-y-1;
  }

  .interactive-glow {
    @apply transition-all duration-300 ease-out hover:shadow-primary/20 hover:shadow-lg;
  }

  .interactive-shimmer {
    @apply relative overflow-hidden before:absolute before:inset-0 before:-translate-x-full before:animate-shimmer before:bg-gradient-to-r before:from-transparent before:via-white/10 before:to-transparent;
  }

  .interactive-pulse {
    @apply transition-all duration-200 ease-out hover:animate-pulse;
  }

  .interactive-bounce {
    @apply transition-all duration-200 ease-out hover:animate-gentle-bounce;
  }

  .interactive-fade {
    @apply transition-opacity duration-200 ease-out hover:opacity-80;
  }

  .interactive-blur {
    @apply transition-all duration-200 ease-out hover:backdrop-blur-sm;
  }

  .interactive-rotate {
    @apply transition-transform duration-200 ease-out hover:rotate-1;
  }

  .interactive-slide {
    @apply transition-transform duration-200 ease-out hover:translate-x-1;
  }

  /* Button micro-interactions */
  .btn-ripple {
    @apply relative overflow-hidden;
  }

  .btn-ripple::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: currentColor;
    opacity: 0.3;
    transform: translate(-50%, -50%);
    transition: width 0.3s, height 0.3s;
  }

  .btn-ripple:active::before {
    width: 300px;
    height: 300px;
  }

  /* Card micro-interactions */
  .card-interactive {
    @apply transition-all duration-300 ease-out hover:shadow-xl hover:shadow-primary/10 hover:-translate-y-2;
  }

  .card-tilt {
    @apply transition-transform duration-200 ease-out hover:rotate-1 hover:scale-105;
  }

  /* Input micro-interactions */
  .input-focus {
    @apply transition-all duration-200 ease-out focus:ring-2 focus:ring-primary/20 focus:border-primary focus:scale-105;
  }

  /* Loading states */
  .loading-shimmer {
    @apply bg-gradient-to-r from-muted via-muted/50 to-muted bg-[length:200%_100%] animate-shimmer;
  }

  /* Staggered animations */
  .stagger-children>* {
    animation-delay: calc(var(--stagger-delay, 100ms) * var(--index, 0));
  }

  /* Mobile-first text sizes with improved spacing */
  .text-mobile-hero {
    @apply text-2xl font-bold leading-tight;
  }

  .text-mobile-lg {
    @apply text-lg font-semibold leading-tight;
  }

  .text-mobile-sm {
    @apply text-sm leading-relaxed;
  }

  /* Text truncation utilities */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Hover scale animation */
  .hover-scale {
    transition: transform 0.2s ease-in-out;
  }

  .hover-scale:hover {
    transform: scale(1.02);
  }

  .text-mobile-title {
    @apply text-lg font-semibold leading-relaxed;
  }

  .text-mobile-body {
    @apply text-base leading-relaxed;
  }

  .text-mobile-caption {
    @apply text-sm leading-relaxed;
  }

  /* Mobile-optimized grid with better spacing */
  .mobile-grid {
    @apply grid grid-cols-1 gap-3;
  }

  /* Text wrapping utilities for mobile */
  .mobile-text-wrap {
    @apply break-words hyphens-auto;
  }

  .mobile-safe-text {
    @apply break-words overflow-hidden;
  }

  /* Safe area support - use CSS properties directly */
  .safe-area-top {
    padding-top: max(1rem, env(safe-area-inset-top));
  }

  .safe-area-bottom {
    padding-bottom: max(1rem, env(safe-area-inset-bottom));
  }

  /* Bottom navigation spacing - prevents content from being hidden behind bottom nav on mobile */
  .pb-bottom-nav {
    @apply pb-20 lg:pb-0;
  }

  /* Content-visibility for below-the-fold sections */
  .cv-auto {
    content-visibility: auto;
    contain-intrinsic-size: 1px 1000px;
  }

  /* Enhanced Mobile Touch Interactions */
  .touch-feedback {
    @apply transition-all duration-150 active:scale-95 active:opacity-80;
    -webkit-tap-highlight-color: transparent;
  }

  .touch-ripple {
    @apply relative overflow-hidden;
    -webkit-tap-highlight-color: transparent;
  }

  /* Gesture Support Utilities */
  .swipeable {
    touch-action: pan-y pinch-zoom;
    -webkit-user-select: none;
    user-select: none;
  }

  .swipeable-horizontal {
    touch-action: pan-x pinch-zoom;
    -webkit-user-select: none;
    user-select: none;
  }

  .swipeable-vertical {
    touch-action: pan-y pinch-zoom;
    -webkit-user-select: none;
    user-select: none;
  }

  .scrollable-horizontal {
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
  }

  .scrollable-horizontal::-webkit-scrollbar {
    display: none;
  }

  .scroll-snap-item {
    scroll-snap-align: start;
    scroll-snap-stop: always;
  }

  /* Mobile-Optimized Buttons */
  .btn-mobile {
    @apply min-h-[48px] px-6 text-base font-medium rounded-lg touch-feedback;
    -webkit-tap-highlight-color: transparent;
  }

  .btn-mobile-large {
    @apply min-h-[56px] px-8 text-lg font-semibold rounded-xl touch-feedback;
    -webkit-tap-highlight-color: transparent;
  }

  .btn-mobile-icon {
    @apply min-h-[48px] min-w-[48px] rounded-full touch-feedback flex items-center justify-center;
    -webkit-tap-highlight-color: transparent;
  }

  /* Mobile Card Enhancements */
  .card-mobile {
    @apply bg-card rounded-xl p-4 shadow-md touch-feedback;
    -webkit-tap-highlight-color: transparent;
  }

  .card-mobile-interactive {
    @apply card-mobile hover:shadow-xl active:shadow-md transition-all duration-200;
  }

  /* Mobile Input Enhancements */
  .input-mobile {
    @apply min-h-[48px] px-4 text-base rounded-lg border-2 transition-all;
    @apply focus:border-primary focus:ring-4 focus:ring-primary/10;
    -webkit-appearance: none;
    font-size: 16px;
    /* Prevents iOS zoom on focus */
  }

  .textarea-mobile {
    @apply min-h-[120px] p-4 text-base rounded-lg border-2 transition-all;
    @apply focus:border-primary focus:ring-4 focus:ring-primary/10;
    -webkit-appearance: none;
    font-size: 16px;
  }

  /* Mobile List Item */
  .list-item-mobile {
    @apply min-h-[56px] px-4 flex items-center gap-3 touch-feedback;
    -webkit-tap-highlight-color: transparent;
  }

  /* Pull-to-Refresh Support */
  .ptr-content {
    overscroll-behavior-y: contain;
    -webkit-overflow-scrolling: touch;
  }

  .ptr-indicator {
    @apply absolute top-0 left-1/2 -translate-x-1/2 -translate-y-full;
    @apply transition-transform duration-300 ease-out;
  }

  .ptr-pulling .ptr-indicator {
    @apply translate-y-0;
  }

  /* Mobile Navigation Enhancements */
  .nav-mobile {
    @apply fixed bottom-0 left-0 right-0 bg-card border-t border-border;
    @apply safe-area-bottom z-50;
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
  }

  .nav-item-mobile {
    @apply flex-1 flex flex-col items-center justify-center gap-1 py-2 touch-feedback;
    @apply text-muted-foreground hover:text-foreground active:text-primary;
    min-height: 56px;
    -webkit-tap-highlight-color: transparent;
  }

  /* Mobile Modal/Sheet Enhancements */
  .sheet-mobile {
    @apply fixed inset-x-0 bottom-0 rounded-t-2xl bg-card;
    @apply max-h-[90vh] overflow-y-auto;
    @apply safe-area-bottom;
    -webkit-overflow-scrolling: touch;
  }

  .sheet-handle {
    @apply w-12 h-1.5 bg-muted rounded-full mx-auto my-3;
  }

  /* Mobile Search Enhancements */
  .search-mobile {
    @apply w-full min-h-[48px] px-4 pl-11 rounded-full border-2;
    @apply bg-muted/50 border-transparent;
    @apply focus:bg-background focus:border-primary focus:ring-4 focus:ring-primary/10;
    @apply transition-all duration-200;
    font-size: 16px;
    -webkit-tap-highlight-color: transparent;
  }

  /* Mobile Chip/Tag */
  .chip-mobile {
    @apply inline-flex items-center gap-2 px-3 py-1.5 rounded-full;
    @apply bg-primary/10 text-primary text-sm font-medium;
    @apply min-h-[32px] touch-feedback;
    -webkit-tap-highlight-color: transparent;
  }

  /* Mobile Loading States */
  .skeleton-mobile {
    @apply bg-muted animate-pulse rounded-lg;
  }

  /* Mobile Optimized Spacing */
  .stack-mobile {
    @apply flex flex-col gap-4;
  }

  .stack-mobile-sm {
    @apply flex flex-col gap-2;
  }

  .stack-mobile-lg {
    @apply flex flex-col gap-6;
  }

  .inline-mobile {
    @apply flex flex-row flex-wrap items-center gap-2;
  }

  /* Mobile Safe Scrolling */
  .scroll-smooth-mobile {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
  }

  /* Mobile Image Optimization */
  .img-mobile {
    @apply w-full h-auto object-cover;
    content-visibility: auto;
  }

  .img-mobile-contain {
    @apply w-full h-auto object-contain;
  }

  /* Mobile Backdrop */
  .backdrop-mobile {
    @apply fixed inset-0 bg-black/40 backdrop-blur-sm;
    -webkit-backdrop-filter: blur(8px);
    backdrop-filter: blur(8px);
  }

  /* Mobile Divider */
  .divider-mobile {
    @apply h-px bg-border my-4;
  }

  /* Mobile Section */
  .section-mobile {
    @apply px-4 py-6;
  }

  .section-mobile-compact {
    @apply px-4 py-3;
  }

  /* Mobile Header Sticky */
  .header-mobile-sticky {
    @apply sticky top-0 z-40 bg-background/95 backdrop-blur;
    @apply border-b border-border safe-area-top;
  }

  /* Mobile Bottom Actions */
  .bottom-actions-mobile {
    @apply fixed bottom-0 left-0 right-0 p-4 bg-background/95;
    @apply border-t border-border safe-area-bottom backdrop-blur;
  }

  /* Mobile Grid Layouts */
  .grid-mobile-2 {
    @apply grid grid-cols-2 gap-3;
  }

  .grid-mobile-auto {
    @apply grid gap-3;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  }

  /* Mobile Typography Enhancements */
  .heading-mobile {
    @apply text-2xl font-bold leading-tight tracking-tight;
  }

  .subheading-mobile {
    @apply text-lg font-semibold leading-tight;
  }

  .body-mobile {
    @apply text-base leading-relaxed;
  }

  .caption-mobile {
    @apply text-sm text-muted-foreground leading-relaxed;
  }

  /* Mobile Link Enhancement */
  .link-mobile {
    @apply text-primary underline-offset-4 hover:underline active:opacity-70;
    @apply transition-opacity duration-150;
    -webkit-tap-highlight-color: transparent;
  }

  /* Mobile Floating Action Button */
  .fab-mobile {
    @apply fixed bottom-20 right-4 z-50;
    @apply w-14 h-14 rounded-full shadow-lg;
    @apply bg-primary text-primary-foreground;
    @apply flex items-center justify-center;
    @apply touch-feedback hover:shadow-xl;
  }

  /* Mobile Toast/Snackbar Position */
  .toast-mobile {
    @apply fixed bottom-20 left-4 right-4 z-50;
    @apply safe-area-bottom;
  }

  /* Disable default tap highlight on all touch elements */

  body {
    @apply bg-background text-foreground;
    /* Mobile-first font optimization */
    font-synthesis: none;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    /* Mobile viewport handling */
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
  }

  /* Mobile-first responsive typography */
  html {
    font-size: 16px;
    /* Mobile base */
  }

  @media (min-width: 768px) {
    html {
      font-size: 18px;
      /* Tablet */
    }
  }

  @media (min-width: 1024px) {
    html {
      font-size: 20px;
      /* Desktop */
    }
  }

  /* Enhanced safe area support for mobile devices */
  @supports (padding: max(0px)) {
    .safe-area-inset {
      padding-top: max(1rem, env(safe-area-inset-top));
      padding-bottom: max(1rem, env(safe-area-inset-bottom));
      padding-left: max(1rem, env(safe-area-inset-left));
      padding-right: max(1rem, env(safe-area-inset-right));
    }
  }
}

/* Screen reader only content */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Focus styles for better keyboard navigation */
.focus-visible {
  outline: var(--focus-ring);
  outline-offset: var(--focus-ring-offset);
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  :root {
    --border: hsl(0 0% 50%);
    --input: hsl(0 0% 50%);
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {

  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Focus trap for modals and dialogs */
.focus-trap {
  isolation: isolate;
}

/* Skip link styles */
.skip-link {
  position: absolute;
  top: -40px;
  left: 6px;
  background: hsl(var(--primary));
  color: hsl(var(--primary-foreground));
  padding: 8px;
  text-decoration: none;
  border-radius: 0 0 4px 4px;
  z-index: 9999;
  transition: top 0.2s ease-in-out;
}

.skip-link:focus {
  top: 0;
}

/* ========================================
   Accessibility Widget Preference Styles
   Applied via class toggles on <html>
   ======================================== */

/* Scaled text: uses a CSS custom property set by AccessibilityContext */
.a11y-scaled-text {
  font-size: calc(1rem * var(--a11y-font-scale, 1)) !important;
}

/* High contrast mode */
.a11y-high-contrast {
  --foreground: 0 0% 0%;
  --card-foreground: 0 0% 0%;
  --popover-foreground: 0 0% 0%;
  --muted-foreground: 0 0% 20%;
  --border: 0 0% 30%;
  --input: 0 0% 30%;
}

.a11y-high-contrast.dark {
  --foreground: 0 0% 100%;
  --card-foreground: 0 0% 100%;
  --popover-foreground: 0 0% 100%;
  --muted-foreground: 0 0% 85%;
  --border: 0 0% 70%;
  --input: 0 0% 70%;
}

.a11y-high-contrast img {
  filter: contrast(1.2);
}

/* Reduced motion (supplements the prefers-reduced-motion media query) */
.a11y-reduced-motion *,
.a11y-reduced-motion *::before,
.a11y-reduced-motion *::after {
  animation-duration: 0.01ms !important;
  animation-iteration-count: 1 !important;
  transition-duration: 0.01ms !important;
  scroll-behavior: auto !important;
}

/* Dyslexia-friendly font */
.a11y-dyslexia-font {
  font-family: 'OpenDyslexic', 'Comic Sans MS', 'Arial', sans-serif !important;
  word-spacing: 0.15em;
}

.a11y-dyslexia-font * {
  font-family: inherit !important;
}

/* Highlight all links */
.a11y-highlight-links a:not([role="button"]) {
  text-decoration: underline !important;
  text-decoration-thickness: 2px !important;
  text-underline-offset: 3px !important;
  outline: 2px solid currentColor !important;
  outline-offset: 2px !important;
  border-radius: 2px;
}

/* Large cursor */
.a11y-large-cursor,
.a11y-large-cursor * {
  cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Cpath d='M4 4l20 8-8 4-4 8z' fill='black' stroke='white' stroke-width='2'/%3E%3C/svg%3E") 4 4, auto !important;
}

.a11y-large-cursor a,
.a11y-large-cursor button,
.a11y-large-cursor [role="button"],
.a11y-large-cursor input,
.a11y-large-cursor select,
.a11y-large-cursor textarea,
.a11y-large-cursor label {
  cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Cpath d='M8 4v24h4l4-8h8z' fill='black' stroke='white' stroke-width='2'/%3E%3C/svg%3E") 8 4, pointer !important;
}

/* Enhanced focus indicators */
.a11y-highlight-focus *:focus-visible {
  outline: 3px solid hsl(var(--primary)) !important;
  outline-offset: 3px !important;
  box-shadow: 0 0 0 6px hsl(var(--primary) / 0.25) !important;
}

/* Increased text spacing */
.a11y-text-spacing {
  letter-spacing: 0.12em !important;
  word-spacing: 0.16em !important;
  line-height: 1.8 !important;
}

.a11y-text-spacing p,
.a11y-text-spacing li,
.a11y-text-spacing span,
.a11y-text-spacing div {
  letter-spacing: inherit;
  word-spacing: inherit;
  line-height: inherit;
}